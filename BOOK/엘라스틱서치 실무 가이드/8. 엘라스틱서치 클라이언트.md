# 8. 엘라스틱서치 클라이언트
## 8.1 엘라스틱서치 클라이언트 이해하기
### 클라이언트 모듈 소개
엘라스틱서치는 다양한 프로그래밍 언어를 지원하며 아직 지원하지 않는 언어에 대해서는 직접 클라이언트를 개발해서 추가할 수 있는 방법도 제공한다. 

### 자바 클라이언트 모듈
자바 언어를 위해 제공되는 클라이언트에는 두 가지 종류가 있다. 내부적으로 HTTP 방식으로 REST API를 사용해 접근하는 방식과 네티 모듈을 이용해 네이티브 클라이언트를 통해 접근하는 방식이다.

초기 버전의 엘라스틱서치에는 소켓을 이용하는 Transport 클라이언트만 제공됐으나, 여러 문제점을 해결하기 위해 REST 클라이언트가 도입됐다. 엘라스틱서치 7.0 부터는 Transport 클라이언트가 폐기 예정됐기 때문에 최신 버전의 엘라스틱서치를 도입해야 한다면 반드시 REST 클라이언트를 사용해야만 한다.

## 8.2 Transport 클라이언트
### Transport 클라이언트 연결
408~410p

Transport 클라이언트 모듈을 사용하려면 프로젝트에서 메이븐이나 그레이들 설정을 이용해 라이브러리를 내려받아야 한다. Transport 클라이언트는 내부적으로 소켓을 사용해 엘라스틱서치 클러스터에 원격으로 연결된다. 연결을 위해 IP주소와 포트 번호가 필요하다. (기본 포트 9300)

### 매핑 API 사용하기
인덱스를 생성할 때 Indice API를 사용한다. 이를 이용해 인덱스의 샤드 개수를 설정하거나 나만의 분석기를 정의할 수도 있다.

매핑 생성을 위해 필드를 정의하는 스키마를 JSON 형태로 생성해야 한다. 생성된 JSON 데이터를 Transport 클라이언트를 이용해 엘라스틱서치에 전달하면 인덱스가 생성된다. JSON 생성시 다음과 같은 방법을 많이 사용한다.
1. byte[] 혹은 String 객체를 사용해서 수동으로 JSON을 만드는 방법
2. Map 객체로 만들어 JSON 형태로 변환하는 방법
3. Jackson, Gson과 같은 외부 라이브러리로 객체를 만들어 JSON 형태로 변환하는 방법
4. 엘라스틱서치에서 제공하는 XContentFactory, jsonBuilder()를 활용해 JSON을 만드는 방법

XContentFactory를 사용해서 개발하는 것이 여러모로 편리하. 모든 항목은 startObject() 메서드와 endObject() 메서드로 시작과 끝을 표현해야 한다. 필드의 타입이나 속성을 지정할 경우 field() 메서드를 사용한다. 실제 인덱스 생성시에는 client().admin().indices() 메서드를 사용한다. 그리고 prepareCreate() 메서드를 이용해 생성한 인덱스의 이름을 지정하고 설정 정보와 인덱스 정보를 설정하면 된다.
모든 설정이 완료되면 get() 메서드를 호출한다. 호출되는 순간 엘라스틱서치로 매핑 정보를 전송하고 인덱스 생성 여부를 결과로 돌려준다. (412p)
