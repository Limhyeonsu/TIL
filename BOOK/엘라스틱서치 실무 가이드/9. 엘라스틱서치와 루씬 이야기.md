# 9. 엘라스틱서치와 루씬 이야기
## 9.1 클러스터 관점에서 구성요소 살펴보기
엘라스틱서치는 기본적으로 클러스터라는 단위로 데이터를 제공한다. 클러스터는 하나 이상의 물리적인 노드로 이뤄져 있으며 각 노드는 모두 데이터 색인 및 검색 기능을 제공하는 일종의 물리적인 서버이기도 하다. 내부에는 루씬 라이브러리가 자리 잡고 있고, 이는 엘라스틱서치의 근간을 이루는 핵심 모듈이다.

1. 클러스터 : 데이터를 실제로 가지고 있는 __노드의 모음__ 이다. 엘라스틱서치에서는 관련된 모든 노드들을 논리적으로 확장해서 클러스터라고 부른다. 같은 클러스터 내에서만 데이터 공유가 가능하기 때문에 연관된 모든 노드는 하나의 클러스터에서 구성원으로 연결되는 것이 매우 중요하다.
2. 노드 : 물리적으로 실행된 런타임 상태의 엘라스틱서치를 노드라고 부른다. 노드는 논리적인 클러스터를 이루는 구성원의 일부이며 실제 데이터를 물리적으로 가지고 있는 단일 서버이기도 하다. 노드는 내부에 다수의 인덱스를 가지고 있고, 각 인덱스는 다수의 문서를 가지고 있다. 
   * 마스터 노드 - 클러스터의 제어 담당
   * 데이터 노드 - 데이터를 보유하고 CRUD, 검색, 집계 등 데이터 관련 작업 담당
   * 인제스트 노드 - 색인 전 전처리 작업 담당
   * 트라이브 노드 - 여러 클러스터를 제한적으로 연결해서 동시에 검색 수행 (특수한 목적의 노드)
   * 코디네이팅 노드 - 검색, 집계시 분산 처리만을 목적으로 설정된 노드
3. 인덱스 : 유사한 특성을 가지고 있는 문서를 모아둔 문서들의 컬렉션이다. 예) 고객정보, 상품정보, 주문정보 등 클러스터 내에서 `유일한 인덱스명`을 가져야 한다. 또한 인덱스명은 모두 `소문자`로 설정해야 한다.
4. 문서 : 검색 대상이 되는 실제 물리적인 데이터를 뜻한다. 엘라스틱서치에서는 JSON 형식으로 표현된다.
5. 샤드 : 인덱스에는 매우 __많은 양의 문서__ 가 저장될 수 있다. __물리적인 한계를 뛰어넘기 위해 나온 개념이 샤드이다.__ 이를 이용하면 데이터를 분산 저장하는 방식으로 손쉬운 수평 확장이 가능해진다. 인덱스 생성시 기본적으로 5개의 샤드로 데이터가 분산되도록 생성된다.
6. 레플리카 : 샤드의 복제본을 나타낸다. 인덱스 생성시 기본적으로 1개의 레플리카 세트를 생성한다. 검색시 레플리카가 적극적으로 활용되기 때문이 이를 이용하면 읽기 분산에 유리해진다. 인덱스 생성시 샤드수, 레플리카 개수를 자유롭게 설정할 수 있다. 단 인덱스 생성후 변경하는 것이 불가능하다. 
7. 세그먼트 : 샤드 내부에는 루씬 라이브러리를 포함하고 있는데, 이를 이용해 대부분의 검색 기능을 제공한다. 루씬에 데이터가 색인되면 데이터는 최소한의 단위인 토큰으로 분리되고 특수한 형태의 자료구조로 저장되는데 이런 자료구조를 세그먼트라고 한다. `세그먼트는 읽기에 최적화된 자료구조로서 역색인이라는 특수한 형태로 변환되어 물리적인 디스크에 저장된다.`

## 9.2 엘라스틱서치 샤드 VS 루씬 인덱스
457~459p

