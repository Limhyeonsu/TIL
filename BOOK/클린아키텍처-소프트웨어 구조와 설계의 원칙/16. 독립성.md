# 16. 독립성
좋은 아키텍처는 다음을 지원해야 한다.
* 시스템의 유스케이스
* 시스템의 운영
* 시스템의 개발
* 시스템의 배포

## 유스케이스
시스템의 아키텍처는 시스템의 의도를 지원해야 한다. 예) 장바구니 애플리케이션이라면 장바구니와 관련된 유스케이스를 지원해야 한다.

아키텍트의 최우선 관심사는 유스케이스이며, 아키텍처에서도 유스케이스가 최우선이다.

## 운영
시스템이 초당 100,000명의 고객을 처리해야 한다면 아키텍처는 이 요구와 관련된 각 유스케이스에 걸맞는 처리량과 응답시간을 보장해야 한다.

## 개발
아키텍처는 개발환경을 지원하는 데 있어 핵심적인 역할을 수행한다. 많은 팀으로 구성되고 관심사가 다양한 조직에서 어떤 시스템을 개발해야 한다면, 각 팀이 독립적으로 행동하기 편한 아키텍처를 반드시 확보하여 개발하는 동안 팀들이 서로를 방해햐지 않도록 해야 한다.

## 배포
아키텍처는 배포 용이성을 결정하는 데 중요한 역할을 한다. 이때 목표는 즉각적인 배포다. 좋은 아키텍처는 꼭 필요한 디렉터리나 파일을 수작업으로 생성하게 내버려두지 않는다. 좋은 아키텍처라면 시스템이 빌드된 후 즉각 배포할 수 있도록 지원해야 한다. 즉 시스템을 컴포넌트 단위로 적절하게 분할하고 격리시켜야 한다.

## 선택사항 열어두기
좋은 아키텍처는 컴포넌트 구조와 관련된 이 관심사들 사이에서 균형을 맞추고, 각 관심사 모두를 만족시킨다.

현실에서는 이러한 균형을 잡기가 매우 어렵다. 모든 유스케이스를 알 수 없고, 운영하는 데 따르는 제약사항, 팀 구조, 배포 요구사항도 알지 못하기 때문이다. 이러한 사항들을 알고 있더라도 시스템이 생명주기의 단계를 하나씩 거쳐감에 따라 이 사항들도 반드시 변해간다.

이러한 변화속에서 몇몇 아키텍처 원칙은 구현하는 비용이 비교적 비싸지 않으며, 관심사들 사이에서 균형을 잡는데 도움이 된다. 심지어 균형을 맞추려는 목표점을 명확히 그릴 수 없는 경우에도 도움이 된다.

좋은 아키텍처는 선택사항을 열어 둠으로써 향후 시스템에 변경이 필요할 때 어떤 방향으로든 쉽게 변경할 수 있도록 한다.

## 계층 결합 분리
아키텍트는 유스케이스 전부를 알지는 못해도 시스템의 기본적인 의도는 분명히 알고 있다. 따라서 아키텍트는 단일 책임 원칙과 공통 폐쇄 원칙을 적용하여, 그 의도의 맥락에 따라서 다른 이유로 변경되는 것들은 분리하고, 동일한 이유로 변경되는 것들은 묶는다.

## 유스케이스 결합 분리
서로 다른 이유로 변경되는 것에는 유스케이스 그 자체가 있다. 

시스템에서 서로 다른 이유로 변경되는 요소들의 결합을 분리하면 기존 요소에 지장을 주지 않고도 새로운 유스케이스를 계속해서 추가할 수 있게 된다. 

## 결합 분리 모드
유스케이스에서 서로 다른 관점이 분리되었다면, 높은 처리량을 보장해야 하는 유스케이스와 낮은 처리량으로도 충분한 유스케이스는 이미 분리되어 있을 가능성이 높다.

간단히 말해 유스케이스를 위해 수행하는 그 작업들(결합 분리)은 운영에도 도움이 된다. 

## 개발 독립성
컴포넌트가 완전히 분리되면 팀 사이의 간섭은 줄어든다. 업무 규칙이 UI를 알지 못하면 UI에 중점을 둔 팀은 업무 규칙에 중점을 둔 팀에 그다지 영향을 줄 수 없다.

## 배포 독립성
유스케이스와 계층의 결합이 분리되면 배포 측면에서도 고도의 유연성이 생긴다. 결합을 제대로 분리했다면 운영 중인 시스템에서도 계층과 유스케이스를 교체할 수 있다.

## 중복
소프트웨어에서 중복은 일반적으로 나쁜 것이다. 중복에도 여러 종류가 있는데
1) 진짜 중복은 한 인스턴스가 변경되면 동일한 변경을 그 인스턴스의 모든 복사본에 반드시 적용해야한다.
2) 거짓된 또는 우발적인 중복은 중복으로 보이는 두 코드 영역이 각자의 경로로 발전한다면, 즉 서로 다른 속도와 다른 이유로 변경된다면 이 두 코드는 진짜 중복이 아니다.

유스케이스를 수직으로 분리할때 이들 유스케이스가 서로 비슷한 화면 구조, 비슷한 알고리즘, 비슷한 데이터베이스 쿼리와 스키마를 가지고 있어 통합하고 싶은 유혹을 받게 된다. 
`자동 반사적으로 중복을 제거해버리는 잘못을 저지르는 유혹을 떨쳐라! 중복이 진짜 중복인지 확인해야한다.`

계층을 수평으로 분리하는 경우 특정 데이터베이스 레코드의 데이터 구조가 특정 화면의 데이터 구조와 상당히 비슷한 점을 발견할 수 도 있다. 이때 데이터베이스 레코드와 동일한 형태의 뷰 모델을 만들어서 각 항목을 복사하는 게 아니라, 데이터베이스 레코드를 있는 그대로 UI까지 전달하고 싶다는 유혹을 받을 수도 있다. 조심하자

## 결합 분리 모드(다시)
계층과 유스케이스의 결합을 분리하는 방법은 다양하다. 
1. 소스 코드 수준 분리 모드 : 이 모드에서는 모든 컴포넌트가 같은 주소 공간에서 실행되고, 서로 통신할 때는 간단한 함수 호출을 사용한다.
2. 배포 수준 분리 모드 : jar파일, DLL, 공유 라이브러리와 같이 배포 가능한 단위들 사이의 의존성을 제어할 수 있다. 이를 통해 한 모듈의 소스 코드가 변하더라도 다른 모듈을 재빌드하거나 재배포하지 않도록 만들 수 있다.
3. 서비스 수준 분리 모드 : 의존하는 수준을 데이터 구조 단위까지 낮출 수 있고, 순전히 네트워크 패킷을 통해서만 통신하도록 만들 수 있다.