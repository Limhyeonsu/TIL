# 13. JPQL
## 01. JPQL
JPQL은 JPA에서 사용하는 쿼리 언어다. SQL과 매우 유사하나 테이블과 컬럼 이름 대신 매핑한 엔티티 이름과 속성 이름을 사용한다는 차이가 있다.

```java
em.createQuery(
"select r from Review r " +
"where r.hotel = :hotel order by r.id desc", Review.class);
```

## 02. JPQL 기본 코드
`select 별칭 from 엔티티 이름 as 별칭` 별칭은 JPQL에서 엔티티를 참조할 때 사용할 이름으로 필수이다. 

select 의 결과 타입을 알고 있는 경우는 TypedQuery 객체를 생성하는 em.createQuery(String, Class)를 사용한다. 타입을 모르는 경우 Query 타입을 리턴 받는다.

* order by를 이용한 정렬 : 정렬 순서 지정시 엔티티 속성을 사용한다. `별칭.속성`

## 03. 검색 조건 지정
1. 비교 연산자

|연산자| 설명                         |
|---|----------------------------|
|=| 값이 같은지 비교                  |
|<>| 값이 다른지 비교                  |
|>,>=,<,<=| 값의 크기 비교                   |
|between| 값이 사이에 포함되는지 비교            |
|in, not in| 지정한 목록에 값이 존재하는지, 존재하지 않는지 |
|like, not like| 지정한 문자열을 포함하는지 검사          |
|is null, is not null| 값이 Null인지 null이 아닌지        |

2. 콜렉션 비교 : 특정 엔티티나 값이 콜렉션에 속해있는지 검사하고 싶을 때 `member of, not memeber of` 연산자 사용, 엔티티 콜렉션에 대해 콜렉션이 비어있는지 비교할 때`is empty, is not empty` 연산자 사용
3. exists, all, any : exists는 서브 쿼리 속성이 존재하는지, all은 서브 쿼리 결과가 조건을 모두 충족하는지, any느 서브 쿼리 결과 조건을 충족하는 대상 중 하나 이상 충족하는지 검사

## 04. 페이징 처리
Query와 TypedQuery를 사용하면 간단하게 페이징 처리를 할 수 있다. 
* setFirstResult(int startPosition) : 조회할 첫 번째 결과 위치 지정
* setMaxResult(int maxResult) : 조회할 최대 개수

## 05. 지정 속성 조회
1. 배열로 조회하기 : em.createQuery("select p.id, p.name, p.salary from Player p", Object[].class);
2. 특정 객체로 조회하기 : em.createQuery("select new jpastart.common.IdName(p.id, p.name) from Plater p", IdName.class); select 절에 new + 패키지명을 포함한 클래스 이름을 사용하면 해당 클래스의 생성자를 이용해서 결과 객체를 생성한다.

## 06. 한 개 행 조회
query.getResultList()를 사용하면 List 타입을 리턴한다. 대신 getSingleResult() 메서드를 사용하면 한 개 행만 조회한다. 주의할 점은 결과가 반드시 1개여야 한다는 것이다 0 or 두 개 이상일 경우 exception이 발생한다.

## 07. 조인
* 자동조인 : 연관된 엔티티의 속성에 접근할 때 발생힌다. select p from Player p where p.team.name = :teamName;
* 명시적 조인 : join 절을 이용하여 명시적으로 조인한다. select p from Player p join p.team t where t.name = :teamName;
* where 절에서 조인 : select u, s from User u, UserBestSight s where u.email = s.email;

## 08. 집합 함수
값이 존재하지 않는 경우에는 null 반환
* count
* max, min
* avg
* sum

## 09. group by 와 having

