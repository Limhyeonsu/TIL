# 7. 엔티티간 1:1 연관 그리고 즉시 로딩과 지연 로딩
## 01. 키를 참조하는 1:1 연관 매핑
User 엔티티와 1:1 매핑되는 MembershipCard 엔티티가 있을때, 각각의 엔티티는 자신의 식별자를 가지고, MembershipCard는 1:1 연관을 맺는 User 객체를 가지고 있다.

MembershipCard 객체를 생성하기 위해서는 membership_card 테이블과 user 테이블을 함께 조회한 뒤 MembershipCard 객체와 User 객체를 알맞게 생성해야 한다. JPA를 사용하면 간단한 설정으로 두 엔티티 객체 간의 1:1 연관을 처리할 수 있다.

## 02. 참조키를 이용한 1:1 단방향 연관
```java
@Entity
@Table(name="membership_card")
public class MembershipCard {
    @Id
    @Column(name="card_number")
    private String number;
    
    @OneToOne                       //User 엔티티와 1:1 연관
    @JoinColumn(name="user_email")  //User 객체의 식별자에 해당하는 참조키로 user_email을 지정
    private User owner;
    
    @Temporal(TemporalType.DATE)
    @Column(name="expiry_date")
    private Date expiryDate;
    private boolean enabled;

    //...
}
```

MembershipCard 객체를 구하면 OneToOne으로 연관된 User 객체를 로딩해서 owner 필드에 할당한다. 따라서 membershipCard.getOwner()를 이용해서 1:1로 연관된 User 객체에 접근할 수 있다.

영속 상태가 아닌 User 객체를 MembershipCard의 owner 필드에 할당하게 되면 트랜잭션 커밋 시점에 Exception이 발생하게 된다.

## 03. 1:1 연관의 즉시 로딩과 지연 로딩
find()를 통해 MembershipCard 객체를 구하면 외부 조인을 이용해서 MembershipCard 객체와 함께 연관된 User 객체를 한 쿼리로 함께 로딩한다. 이렇게 연관된 객체를 함께 로딩하는 것을 __즉시 로딩(eager)__ 이라고 한다.

즉시 로딩은 연관된 객체를 함께 불러오는데 연관된 객체를 함께 사용하지 않으면 필요 없는 객체를 로딩하게 된다는 것을 뜻한다.

연관된 객체가 필요한 기능보다 필요하지 않은 기능이 많다면 __지연 로딩(lazy)__ 을 사용해서 연관된 객체가 필요할 때만 로딩하도록 구현할 수 있다.

지연 로딩은 연관 객체를 실제 사용하는 시점에 로딩하는 방식으로 설정 방법은 @OneToOne(fetch=FetchType.LAZY)를 지정하면 된다.  지연 로딩을 사용하면 owner 필드에 처음 접근하는 시점에 user 테이블을 조회해 온다. __@OneToOne에서는 Eager를 기본 값__ 으로 갖는다.