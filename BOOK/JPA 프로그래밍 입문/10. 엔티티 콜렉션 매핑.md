# 10. 엔티티 콜렉션 매핑
## 01. 엔티티 콜렉션 매핑과 연관 관리
```java
public class Team {
    private Set<Player> players = new HashSet<>();
    
    public void addPlayer(Player p) {
        this.players.add(p);
    }
}

```
한 개의 팀 엔티티가 여러 선수와 연관을 갖는 1:N 연관이 된다. 

```java
//1. 단방향 연관일때 Player의 팀을 옮기는 코드
Team team1 = new Team("팀1");
Team team2 = new Team("팀2");

Player player1 = new Player("선수1");
team1.removePlayer(player1);
team2.addPlayer(player1);

//2. 양방향 연관
public class Player {
    private Team team;
    
    //....

}

Team team1 = findTeam("팀1");
Team team2 = findTeam("팀2");
Player player1 = findPlayer("선수1");

team1.removePlayer(player1);
player1.setTeam(team2);
team2.addPlayer(player1);
```

M:N 연관
```java
public class Product {
    private Set<Category> categories;
    //...
}

public class Category {
    private Set<Product> products;
    //...
}
```

1:N 양방향 연관과 M:N 양방향 연관은 양방향 연관을 관리하기 위해 코드가 복잡해진다.

## 02. 1:N 단방향 엔티티 Set 매핑
```java
@Entity
public class Team {
    
    //...
    
    @OneToMany
    @JoinColumn(name="team_id")
    private Set<Player> players = new HashSet();
    
    //...

}
```
Team -> Player로 1:N 단방향 연관이므로 Player 엔티티에서는 Team으로의 연관을 갖지 않는다.  Player 엔티티는 `Set에 저장되므로 equals와 hashCode 메서드`를 구현한다.

### 2.1 1:N 연관의 저장과 변경
```java
Player p3 = em.find(Player.class, "P3");
Player p4 = new Player("P4", "선수4");
Player p5 = new Player("P5", "선수5");

//관리 상태로 만들어 준다
em.persist(p4); 
em.persist(p5);

Team t3 = new Team("T3", "팀3");
t3.addPlayer(p4);
t3.addPlayer(p5);
t3.addPlayer(p3);
em.persist(t3);

```

1:N 연관에서 주의할 점은 @OneToMany 연관에 저장되는 대상이 `관리 상태`의 엔티티여야 한다.