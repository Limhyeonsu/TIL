# 5. 서비스 추상화
## 5.1 사용자 레벨 관리 기능 추가
간단한 CRUD만 있었던 UserDao에 간단한 비즈니스 로직을 추가해본다. 

* 사용자 레벨은 BASIC, SILVER, GOLD 세 가지 중 하나
* 처음 가입시 BASIC 레벨, 이후 한 단계씩 업그레이드 된다.
* 가입 후 50회 이상 로그인시 BASIC에서 SILVER 레벨이 된다.
* SILVER 레벨이면서 30번 이상 추천을 받으면 GOLD 레벨이 된다.
* 사용자 레벨 변경 작업은 일정한 주기를 가지고 일괄적으로 진행된다. 변경 작업 전 조건을 충족하더라도 레벨의 변경이 일어나지 않는다.

### 필드 추가

```java
//1. Level enum 생성
public enum Level {
    BASIC(1), SILVER(2), GOLD(3);
    
    private final int value;
    
    Level(int velue) {
        this.value = value;
    }
    
    public int intValue() {
        return value;
    }
    
    public static Level valueOf(int value) {
        switch(value) {
            case 1: return BASIC;
            case 2: return SILVER;
            case 3: return GOLD;
            default: throw new AssertionError("Unknown value: " + value);
        }
    }
}

//2. User 필드 추가
public class User {
    //...
    Level level;
    int login;
    int recommend;
    
    // getter/setter ..
    
}

//3. 필드 추가에 따른 테스트 코드 수정

//4. UserDaoJdbc 수정
public class UserDaoJdbc implement UserDao {
    //...
    private RowMapper<User> userMapper = 
        new RowMapper<User>() {
            public User mapRow(ResultSet rs, int rowNum) throws SQLException {
                User user = new User();
                user.setId(rs.getString("id"));
                user.setName(rs.getString("name"));
                user.setPassword(rs.getString("password"));
                user.setLevel(Level.valueOf(rs.getInt("level")));
                user.setLogin(rs.getInt("login"));
                user.setRecommend(rs.getInt("recommend"));
                return user;
            }
        
        }
    
    public void add(User user) {
        this.jdbcTemplate.update("insert into users(id, name, password, level, login, recommend) values(?,?,?,?,?,?)", user.getId(), user.getName(), user.getPassword(), user.getLevel().intValue(), user.getLogin(), user.getRecommend());
    }
    
}
```
add 할 때 Level 타입의 level 필드는 DB에 저장할 수 있는 SQL 타입이 아니므로 정수형으로 값을 변환해주어야 한다. (user.getLevel().intValue()) 반대로 조회할 때는 ResultSet에서 DB 타입인 int로 level 정보를 가져와서 Level.valueOf()를 이용해 int 값을 Level 타입의 enum 오브젝트로 만들어서 setLevel() 매서드에 넣어줘야 한다.